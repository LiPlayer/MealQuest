# MealQuest 小白上手测试手册（局域网手机版）

适用对象：第一次接触项目的你（不需要懂代码）。
目标：你可以在本地电脑当服务器，用手机完成商户端和顾客端全流程验证，并知道下一步做什么。

---

## 1. 你现在要理解的最小结构

1. `MealQuestServer`：后端服务（电脑上运行）。
2. `MealQuestMerchant`：商户手机 App（老板/店员用）。
3. `meal-quest-customer`：顾客微信小程序（顾客用）。

一句话：
电脑跑服务，手机跑商户 App，微信里跑顾客小程序。

---

## 2. 开始前准备（一次性）

1. 电脑和手机连接同一个 Wi-Fi。
2. 电脑已安装 Node.js 和 npm。
3. Android 手机已开启 USB 调试（如果你要真机安装商户 App）。
4. 微信开发者工具已安装（用于顾客端小程序预览/真机调试）。

---

## 3. 一次完整测试怎么跑（推荐顺序）

### 第一步：启动电脑服务器（局域网）

在仓库根目录执行：

```powershell
.\scripts\start-server-lan.ps1 -Port 3030
```

看到类似输出即成功：

- `LAN IP candidates: 192.168.x.x`
- `MealQuestServer listening on 0.0.0.0:3030`

记下你的电脑 IP，比如：`192.168.31.10`。

### 第二步：启动商户端（老板 App）

新开终端，仓库根目录执行：

```powershell
.\scripts\start-merchant-app.ps1 -Mode online -Platform android -ServerBaseUrl 'http://192.168.31.10:3030'
```

说明：

1. `online` 表示走真实本地后端 API（不是纯本地假数据）。
2. 这个命令会自动注入环境变量、启动 Metro、安装并运行 debug App。

### 第三步：启动顾客端（微信小程序）

新开终端，仓库根目录执行：

```powershell
.\scripts\start-customer-weapp.ps1 -Mode online -ServerBaseUrl 'http://192.168.31.10:3030' -StoreId 'm_my_first_store'
```

然后在微信开发者工具中打开/预览项目，进入顾客流程。

---

## 4. 你应该按什么步骤测试（老板 + 顾客）

## 4.1 老板角色（商户端）

按页面流程走：

1. 手机号登录。
2. 新手引导。
3. 开店（创建门店）。
4. 特约商户入驻申请。
5. 进入经营驾驶舱。

验收标准：

1. 能进入驾驶舱，不报错。
2. 能看到提案、活动、审计、联盟、社交、请客买单模块。
3. 能执行关键操作（如策略提案/确认、活动启停、熔断开关）。

## 4.2 顾客角色（小程序）

按页面流程走：

1. 启动页进入门店。
2. 首页查看资产卡与活动区。
3. 发起一次支付。
4. 进入账户中心查看流水/发票。
5. 尝试注销（二次确认）。

验收标准：

1. 能进入 `startup -> index -> account`。
2. 支付后有流水变化。
3. 发票列表可读（当前为平台侧能力）。
4. 注销动作有二次确认，并能返回启动页。

---

## 5. 一眼判断“是否跑通”的检查单

全部满足即可判定“本地联调跑通”：

1. 服务端终端显示已监听 `0.0.0.0:3030`。
2. 商户端 App 能打开并完成开店链路。
3. 顾客端小程序能进首页并完成至少一笔支付。
4. 顾客账户中心能看到本人流水。
5. 商户端能看到策略/审计/实时事件变化。

---

## 6. 常见问题（小白高频）

1. 手机连不上服务端：
   - 原因：用了 `127.0.0.1`。
   - 处理：改成电脑局域网 IP（如 `192.168.x.x`）。

2. 连上 Wi-Fi 也不通：
   - 原因：Windows 防火墙拦截 3030。
   - 处理：放行 Node.js 或放行 TCP 3030 入站。

3. 微信小程序请求失败：
   - 处理：微信开发者工具开启“开发环境不校验域名/TLS”。

4. 商户端起不来：
   - 先执行 `npm start` 看 Metro 是否正常。
   - 再执行 `npm run android`。

5. 你不确定是代码问题还是环境问题：
   - 先跑一遍发布门禁：

```powershell
node .\scripts\release-local.js
```

---

## 7. 下一步怎么判断（决策树）

如果你当前目标是“可演示”：
1. 先固定用 `online + 局域网` 跑通双端流程。
2. 把关键路径录屏（老板开店、顾客支付、对账）。

如果你当前目标是“准备上线”：
1. 先补齐你最关心的真实能力（你已选择后置支付网关）。
2. 先做稳定性和回归（每天跑 `release-local`）。
3. 再进入发布打包、灰度和监控。

---

## 8. 你每天可以照抄的最小流程

```powershell
# 终端1：服务器
.\scripts\start-server-lan.ps1 -Port 3030

# 终端2：商户端（把 IP 改成你电脑 IP）
.\scripts\start-merchant-app.ps1 -Mode online -Platform android -ServerBaseUrl 'http://192.168.31.10:3030'

# 终端3：顾客端（把 IP 改成你电脑 IP）
.\scripts\start-customer-weapp.ps1 -Mode online -ServerBaseUrl 'http://192.168.31.10:3030' -StoreId 'm_my_first_store'
```

---

## 9. 你现在最该做的事

1. 先完整跑一遍第 3 章流程。
2. 按第 5 章检查单逐项打勾。
3. 把卡住的步骤和报错原文发我，我按你的现场日志逐条排障。
