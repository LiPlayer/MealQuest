# “餐餐有戏/MealQuest”平台产品全景定义白皮书 (V12.0 - 结构优化版)

> **关联文档**: 
> *   [餐餐有戏 - 顾客端产品全景需求 (Master Customer Spec)](./MealQuest_Customer_Spec.md)
> *   [有戏掌柜 - 商户端产品全景需求 (Master Merchant Spec)](./MealQuest_Merchant_Spec.md)


## 一、 项目愿景与核心治理原则 (Vision & Principles)

### 1. 核心定位
“餐餐有戏”旗下包含两款核心产品：**餐餐有戏** C 端顾客版，**有戏掌柜** B 端商户版。这不仅是一个餐饮 SaaS 平台，更是一个由 AI 驱动、以“独占感”为核心的 **品牌私域操作系统**。

*   **去平台化**：弱化平台存在感，强化商家品牌主权。
*   **资产化**：利用 AI 叙事能力将营销工具转化为具有故事厚度的数字资产。
*   **AI 托管**：通过 AI 数字运营引擎实现从“手动配置规则”到“策略确认”的经营降维打击。

### 2. 治理原则：商家经营主权 (The Sovereignty)
*   **无请求不决策**：AI 仅在授权边界内运行所定义的规则。
*   **无确认不执行**：所有营销策略、资产发放、核销规则，必须由商家显式点击确认。

---

## 二、 产品架构与终端定义 (Product Architecture)

### 1. 元数据驱动架构
系统采用 **元数据驱动 (Metadata-Driven)** 核心，实现逻辑与内容的深度解耦：
1.  **内容层**：AI 解析商家意图，生成结构化的 `Story JSON`。
2.  **资产层**：统一的 `Standardized Asset Model` 容器，承载 ID、2D 视觉与逻辑。

### 2. 终端场景旅程
*   **商家端 (有戏掌柜)**：
    *   **核心功能**：经营驾驶舱 (Dashboard)、安全红线配置、AI 策略建议确认。
    *   **特色**：支持“沉浸式试玩”与“极简进件”。
*   **顾客端 (餐餐有戏)**：
    *   **核心旅程**：扫码即达 $\rightarrow$ 候餐互动 (玩游戏/看故事) $\rightarrow$ 智能支付 $\rightarrow$ 资产沉淀。
    *   **特色**：无感支付与资产合成体验。

### 3. 系统边界与“轻量级”声明 (System Boundaries for SMEs)
我们专为**中小型商户与夫妻店**设计，提供超越传统收银机的“资产化支付”体验。
*   **做“支付闭环”，不做“点餐流程”**：
    *   **支持**：微信支付、余额储值、积分抵扣、优惠券核销。我们是您的**“智能收银台”**。
    *   **不做**：点菜宝、后厨 KDS、桌台管理。无论您是口头点单还是手写小票，最后一步只需**“让顾客扫我们的码付款”**即可完成营销闭环。
*   **做“会员资产”，不做“进销存”**：
    *   **支持**：自动发券、精准营销、会员画像。
    *   **不做**：供应链管理、采购入库、食材成本核算。

---

## 三、 AI 数字资产经济系统 (The Economic System)

本系统定义了商户私域流量的“货币体系”，旨在建立高粘性用户关系。

### 1. 核心资产定义
| 资产类型 | 名称 | 功能定义 | 心理暗示 |
| :--- | :--- | :--- | :--- |
| **通用货币** | **碎银子 (Silver)** | 保底货币。用于抵扣零头或集市交易。 | “我有钱在这儿” |
| **粘性诱饵** | **食材碎片 (Fragments)** | 中间资产。AI 生成的高清 2D 素材，集齐合成饭票。 | “就差这一个了” |
| **核心权证** | **入席令 (Gourmet Cards)** | 最终核销物。带有全息特效的数字饭票。 | “这是我的资产” |
| **资金账户** | **储值余额** | 分为**本金账户** (可退) 与 **赠送账户** (不可提现)。 | “存款安全感” |

### 2. 资产流转闭环 (The Asset Loop Matrix)

| 资产类型 | 获取来源 (Source) | 消耗途径 (Sink) | 核心驱动力 |
| :--- | :--- | :--- | :--- |
| **1. 储值余额** | • 现金充值 (P12)<br>• 营销赠送 (P02) | • **支付抵扣** (P15)<br>• 购买大额付费道具 (低频) | 安全感 & 优惠 |
| **2. 碎银子** | • 消费返利 (1元=1两)<br>• 步数兑换 (1k步=10两)<br>• 游戏产出 (P11) | • **集市买材料** (P10)<br>• 游戏入场费<br>• 支付抵扣零头 | 高频活跃 |
| **3. 食材碎片** | • 单笔满额赠送<br>• 累计步数里程碑<br>• 集市碎银购买 | • **合成入席令** (P04)<br>• 溢出分解为碎银 | 收集癖 (FOMO) |
| **4. 入席令** | • 碎片合成 (P04)<br>• 社交转赠 (P20) | • **到店核销/点餐** (P15)<br>• 转赠朋友 | 价值兑付 |

---

## 四、 智能中枢：AI 数字运营官 (The AI Brain)

### 1. 决策模型
AI 基于风险调整期望值公式 $E_{final}$ 实时寻找最优解，在“激进获客”与“稳健毛利”间动态平衡。

### 2. 交互全链路 (Automated Workflow)
AI 运营并非总是单向输出，而是一个**双向对话**的闭环。

#### 分支 A：AI 提案流 (Passive Mode)
1.  **感知 (Sense)**：AI 巡检发现环境异常（如暴雨、库存积压）。
2.  **建议 (Propose)**：生成策略卡片推送到老板端。
3.  **决策 (Decide)**：老板在“决策收件箱”一键确认。
4.  **执行 (Act)**：系统自动部署 TCA 规则。

#### 分支 B：意图交互流 (Proactive Mode)
老板不再需要配置复杂的参数（如“满100减20”），只需告诉 AI **“想要什么结果”**。
1.  **意图输入 (Intent Input)**：老板输入口语化指令（如：“明天帮我提升午市客流” 或 “这周主推小龙虾”）。
2.  **方案生成 (Strategy Generation)**：AI 基于历史数据生成**若干最具潜力的差异化方案**（如：激进引流 / 稳健保利）供选择。
3.  **确认执行 (Confirm)**：老板选择其一，AI 自动拆解为生成海报文案与 TCA 规则并执行。

### 3. 紧急干预与人工接管 (Emergency Override & Manual Takeover)
商家拥有超越 AI 的最高权限 (**Superuser**)，可随时接入“驾驶模式”。
*   **熔断机制 (Kill Switch)**：当监测到毛利骤降或遭遇“羊毛党”攻击时，可一键**“暂停所有营销”**。
*   **定向急售 (Fire Sale)**：针对临期备料，手动设定**“暴力掉落”**（如：30分钟内必出），系统自动生成最高优先级 (`Priority: 999`) 规则覆盖日常逻辑。
*   **时效保护 (TTL)**：所有人工强制规则均自动携带**过期时间**（如 4 小时），防止因忘记关闭而造成长期损失。

### 4. 技术底座：TCA 原子规则引擎 (The Atomic Rule Engine)
TCA 引擎是整个“AI 决策”落地的执行器，它摒弃了硬编码的业务逻辑，采用 **“三段式”** 动态组装协议。

#### (1) 触发器 (Trigger)：定义“何时”介入
系统并不时刻运行，而是基于关键事件唤醒。
*   **物理世界触发**：用户进店扫码、完成支付、甚至仅仅是路过（LBS 围栏）。
*   **数字行为触发**：用户打开游戏、步数达标、或长期未登录（召回）。
*   **环境变更触发**：突降暴雨、气温骤降、某菜品库存积压报警。

#### (2) 条件判定 (Condition)：决策“是否”执行
当触发器被激活后，AI 会瞬间扫描数十个维度的上下文数据进行“逻辑与 (AND)”判定。
*   **环境上下文**：当前是否下雨？现在是午市高峰还是闲时？
*   **商业上下文**：库存是否积压？当日营收目标是否达成？
*   **用户上下文**：这是新客还是老客？他喜欢吃辣吗？他的碎银余额是否充足？

#### (3) 动作执行 (Action)：决定“如何”干预
一旦所有条件满足，引擎将执行由原子指令组合而成的复合动作。
*   **资产发放**：直接向用户钱包注入特定的“食材碎片”或“优惠入席令”。
*   **界面注入**：在用户首页动态插入一张“下雨天专属卡片”或“库存急售通知”。
*   **触达推送**：发送微信服务通知或 App 推送，召唤用户回店。

### 5. AI 动态画像与精准营销 (Dynamic Persona & Precision Marketing)
系统采用**“闭环数据驱动 (Closed-Loop Data)”**，基于平台内可验证的行为与资产交互来构建画像，不依赖第三方 POS 点单明细。

*   **数据转化 (Data to Tag)**：
    *   **口味偏好**：频繁**核销**麻辣类入席令/在集市**购买**辣椒素材 $\rightarrow$ 标记 `[嗜辣狂魔]`。
    *   **活跃习惯**：支付/核销时间多集中在周二午市 $\rightarrow$ 标记 `[周二常客]`。
    *   **价格敏感**：仅在有折扣券/免费碎片合成时发生核销 $\rightarrow$ 标记 `[价格敏感型]`。
*   **精准投放 (Tag to Action)**：
    *   **新品推介**：一旦上架特辣入席令，仅向 `[嗜辣狂魔]` 推送定向碎片福利。
    *   **沉默唤醒**：针对 `[周二常客]` 在周一晚上定向发送“明天见”专属福利。

    *   **沉默唤醒**：针对 `[周二常客]` 在周一晚上定向发送“明天见”专属福利。

---

## 五、 技术与安全底座 (Tech & Security Foundation)

### 1. AI 2D 资产管线
*   **生成**：AI 模型根据实拍图生成 Isometric 风格插画。
*   **渲染**：Canvas 粒子特效 + CSS 3D Transform 赋予卡片厚度感。

### 2. 安全与合规 (Security & Compliance)
*   **金融安全**：严格区分本金与赠送账户；执行 **Clawback (回溯扣款)** 算法确保退款时扣除已消费的赠送权益。
*   **隐私保护**：遵循微信隐私规范；店员添加采用**端到端二维码握手**，不留存敏感明文。
*   **物理保险丝**：每日预算熔断机制，确保 AI 营销支出严格限制在老板设定的红线内。

### 3. 内容协议规范 (Story Protocol: The JSON Standard)
Story JSON 是连接 AI 决策大脑与小程序盲渲染层的**可移植内容容器**。它不硬编码界面，而是封装了“此时此刻”用户应当感知到的完整体验。

*   **情感叙事 (Narrative)**：必须包含引发共鸣的简短文案（如“雨天热汤”、“午夜慰藉”），拒绝冷冰冰的促销语言。
*   **视觉绑定 (Visual Binding)**：必须直接引用 CDN 上的高清等轴测资产 (Isometric Assets) 或动态 Lottie 文件，确保视觉冲击力。
*   **原子化交付 (Atomic Delivery)**：所有的 UI 布局模板 ID、文案、图片与交互触发器 (Trigger) 必须打包在一个 JSON 包中，确保在任何终端（如微信、Web）的一致性渲染。

### 4. 实时云端架构 (Real-Time Cloud Infrastructure)
为了支撑 AI 决策与资产的高频交互，系统依托于 **云原生 (Serverless)** 架构：

*   **SaaS 多租户架构**：商家无需购买物理服务器，数据存储于云端隔离的租户空间。
*   **AI 算力池 (GPU Scaling)**：TCA 引擎与 AIGC 图像生成服务运行于弹性 GPU 集群，按需调用，确保秒级响应。
*   **WebSocket 即时通讯**：全链路采用长连接通道。商家的“清库存”指令通过云端下发，< 200ms 内同步至所有在线顾客端，实现**毫秒级动态运营**。

### 5. 电子发票助手 (E-Invoice Assistant)
鉴于合规性与商户体量差异，我们采用 **“双轨制”** 策略：
*   **模式 A：标准手动版 (Standard - Free)**：
    *   **适用**：价格敏感的小微商户。
    *   **流程**：顾客申请 $\rightarrow$ 老板App收到通知并一键复制抬头 $\rightarrow$ 自行在税控软硬件开票 $\rightarrow$ **手动回传** PDF/图片 $\rightarrow$ 顾客小程序内下载。
    *   **特点**：零成本，但需人工介入。
*   **模式 B：自动托管版 (Premium - Paid)**：
    *   **适用**：高频开票的大中型商户。
    *   **流程**：商户付费接入第三方服务商（如百望/票通） $\rightarrow$ 系统通过 API 自动提交开票请求 $\rightarrow$ **秒级自动回传** PDF $\rightarrow$ 顾客小程序内下载。
    *   **特点**：全自动零人工，但需承担接口费与通道费。

---

## 六、 项目路线图与里程碑 (Roadmap)

*   **Phase 1: 核心资产化 (The Assets Foundation)**
    *   建立碎银、碎片、入席令的完整元数据闭环。
    *   上线《神厨飞刀》基础版，跑通游戏产出链路。
*   **Phase 2: 智能运营中枢 (The AI Brain)**
    *   启用智能决策卡片与老板决策收件箱。
    *   上线 TCA 引擎，支持天气、库存等复杂联动规则。
*   **Phase 3: 社交与品牌生态 (The Ecosystem expansion)**
    *   完成入席令的社交转赠与“人情礼券”链路。
    *   探索跨店资产互通（商盟模式）与品牌数字藏品展厅。

---

---

## 七、 附录：标准营销策略库 (Appendix: Marketing Strategy Library)

本系统支持的所有策略均基于 **“TCA 规则引擎”** 动态部署，旨在将商业意图无感转化为用户数字资产 (Assets)，完全摒弃传统优惠券逻辑。

### 0. 策略多态性定义 (Strategy Polymorphism)
本库中定义的不仅是单一活动，而是 **“策略模版 (Templates)”**。商户可基于同一模版创建**多个并行实例**。
*   **多实例并行 (Multi-Instance)**：例如，商户可同时运行两个“LBS 围栏掉落”活动：
    *   *实例 A*：针对午市（11:00-14:00），掉落“免费小菜”。
    *   *实例 B*：针对晚市（17:00-20:00），掉落“酒水抵扣券”。
*   **冲突解决 (Conflict Resolution)**：若多个实例在同一场景下被触发（如时段重叠），系统将依据 **“用户利益最大化”** 原则，优先执行价值最高的策略实例。

### 1. 拉新获客 (Acquisition)
*   **新人见面礼 (Welcome Gift)**：扫码首次登录，AI 自动分发**“新手入席令”**（如：葱油拌面兑换证），所见即所得，无门槛核销。
    *   *商家配置*：**资产类型**（选择赠送哪道菜，如葱油拌面）、**每日上限**（每日最多发放份数，如50份）。
    *   *系统风控*：**设备锁**（单手机号/设备仅限领取1次）、**日预算熔断**（单日最大补贴金额上限，如500元）。
*   **面对面邀请 (Referral)**：老客邀请新客扫码，双方各获 **500两 碎银**。
    *   *商家配置*：**邀请奖励**（邀请人获赠碎银数）、**受邀奖励**（新客获赠碎银数）。
    *   *系统风控*：**频次限制**（单人每日有效邀请上限，如5人）、**同源拦截**（自动识别并拦截相同IP/Wi-Fi下的刷单行为）。
*   **LBS 围栏掉落 (Geofence Drop)**：路过店铺 500米范围内，手机震动掉落一枚**“稀有食材碎片”**，诱导进店合成。
    *   *商家配置*：**围栏半径**（如500米）、**掉落概率**（如30%）。
    *   *系统风控*：**疲劳度控制**（每用户每7天仅触发1次）。
*   **异业联盟 (Cross-Promo)**：在合作商家（如隔壁奶茶店）消费，可获得本店的**“通用碎银包”**。
    *   *商家配置*：**关联商户**（绑定合作方ID）、**触发门槛**（最低消费触发金额，如10元）。

### 2. 促活提频 (Activation)
*   **周期会员日 (Asset Multiplier)**：每周固定会员日，全场游戏与消费产生的 **碎银/碎片** 实行 **2.0x 倍率**掉落。
    *   *商家配置*：**倍率设定**（如2.0倍）、**生效时段**（如 10:00-22:00）。
    *   *系统风控*：**产出熔断**（单日全场总产出上限，如10万碎银）、**营收联动**（若当日营收低于设定阈值，自动关闭活动）。
*   **步数换钱 (Walk to Earn)**：每日步数自动折算为**碎银**（1000步 = 10两），步数达标（10000步）额外掉落**“健康蔬菜碎片”**。
    *   *商家配置*：**兑换汇率**（如每100步兑换1碎银）。
    *   *系统风控*：**单人上限**（单人每日获取上限，如200碎银）、**数据校验**（仅接受微信加密步数数据）。
*   **集齐召唤 (Collection Drive)**：限时开启“隐藏食谱”合成任务，需收集特定 4 种碎片合成传说级**“霸王餐入席令”**。
    *   *商家配置*：**目标食谱**（指定合成目标）、**任务时长**（如24小时）。
*   **环境关怀 (Contextual Drop)**：检测到降雨/高温，自动向全员空投**“雨天慰藉碎片”**（合成热汤）或**“清凉碎片”**（合成冰饮）。
    *   *商家配置*：**触发阈值**（如降雨量 mm/h 或 气温 °C）。

### 3. 提客单/去库存 (Revenue)
*   **支付盲盒 (Paybox)**：单笔实付满 ¥30，必定掉落一个**“食材盲盒”**（开出随机碎片，小概率出入席令）。
    *   *商家配置*：**最低门槛**（如单笔满30元）、**概率分布**（碎银/碎片/入席令的掉落占比）。
    *   *系统风控*：**利润保护**（确保奖品补贴价值低于单笔毛利的10%）。
*   **AI 暴击掉落 (Dynamic Drop Rate)**：针对后厨积压的 SKU（如：鲈鱼），系统自动提升该 SKU 对应**“鱼肉碎片”**的掉落概率，加速合成核销。
    *   *商家配置*：**目标食材**（需促销的SKU）、**概率倍增**（如掉率提升5倍）。
    *   *系统风控*：**库存联动**（库存低于安全线如5份时，自动停止策略）。
*   **阶梯返利 (Tiered Cashback)**：实付金额越高，返还的 **碎银** 比例呈指数级增长（如：满100返5%，满200返10%）。
    *   *商家配置*：**阶梯规则**（自由设定各档位的返还比例）。

### 4. 召回留存 (Retention)
*   **沉默唤醒 (Recall Injection)**：系统向 30 天未到店用户账户直接注入一枚**“即将过期的稀有碎片”**（仅差该碎片即可合成大菜），利用“厌恶损失”心理促使回店。
    *   *商家配置*：**沉默判定**（未活跃天数，如30天）、**资产价值**（注入资产的最大成本上限）。
*   **资产过期预警 (Expiry Alert)**：推送通知：“您的 5000 两碎银将于明日过期，请尽快回店使用”。
    *   *商家配置*：**预警周期**（提前N天推送，如3天）。
*   **生日特权 (Birthday Grant)**：生日当天，系统自动合成一张全特效**“长寿面入席令”**放入卡包。

### 5. 社交裂变 (Social Viral)
*   **入席令转赠 (Asset Transfer)**：允许用户将未核销的 **入席令** 直接转赠给微信好友（作为社交礼物），接收方点击即可存入自己的卡包。
*   **手气碎片包 (Fragment Packet)**：支付完成后，可生成一个“拼手气碎片包”分享至群聊，好友领取随机**碎银**或**碎片**。
    *   *商家配置*：**红包个数**（如5个）、**总碎银池**（如1000两）。
    *   *系统风控*：**领取限制**（单人单包仅限领取1次）。
*   **请客买单 (Treat Paying)**：支持购买多张**入席令**合成“请客包”，发到群里由朋友抢单核销。
    *   *商家配置*：**团购折扣**（如88折）。

**全局安全红线 (Global Safety)**:
*   **预算熔断**：若当日营销总补贴超过设定的红线（如200元），系统强制停止所有AI发放策略。
*   **库存硬联锁**：严禁发放无库存商品对应的入席令，确保“所见即所得，所得即有货”。

---

## 八、 总结

*   **老板端**：管理降维为“判定题”，赠送账户平衡了营销与安全。
*   **顾客端**：消费升级为“品牌资产收集之旅”，余额与碎片产生极强回访动力。
*   **系统端**：基于元数据驱动与 AI 2D 管线，构建了高兼容、高粘性的商业壁垒。

> 支付不是结束，而是私域资产关系的开始。