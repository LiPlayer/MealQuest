# 餐餐有戏 顾客端产品全景需求文档 (Master Customer Spec V1.1)

> **项目名称**：餐餐有戏 (MealQuest)
> **核心定义**：基于“资产包”逻辑的单页式餐饮应用。
> **文档目标**：本文档描述了产品的**页面层级结构 (Page Hierarchy)** 及**页面详细布局 (Page Layouts)**，明确所有功能的入口路径。

## 第零章：全局技术规范 (Global Technical Specs)
*   **适用范围**: 全局 (Entire Mini Program).
*   **开发框架**: Taro (Mini Program).
*   **设计分辨率**: 375 x 812 (iPhone X Standard).
*   **适配原则**:
    *   所有页面均需基于 375px 宽度进行设计与开发。
    *   高度：自适应或固定 (812px 基准，需适配全面屏/非全面屏).

---

## 第一章：页面层级结构 (Page Hierarchy)

本系统采用“单页应用 (SPA)” 架构，无传统 TabBar。所有核心入口折叠于首页。

*   **L0. 启动层 (私域独占启动)**
    *   **设计核心**：**去平台化 (De-Platforming)**。小程序启动后，必须让用户感觉这是 **"这家店的专属 App"**，严禁展示“附近门店列表”等公域分流入口。
    *   **冷启动逻辑 (Cold Start)**：
        1.  **若有历史访问记录**：直接加载 **[上次访问门店]** 的首页与数据。用户无感知这是一个平台。
        2.  **若由于外部扫码进入**：直接锁定并加载 **[码对应门店]**。覆盖历史记录。
        3.  **若为纯新用户 (无历史+无扫码)**：
            *   展示 **[空状态 - 扫码页]**。
            *   屏幕中央仅有一个 **[扫一扫]** 按钮与文案：“请扫描桌角或商家二维码，解锁专属美味”。
            *   *绝对不推荐“附近的好店”*。
    *   **LBS 仅作为辅助**：仅用于校验“是否在当前门店服务范围内”（防远程作弊），**绝不用于“找店”**。
*   **L1. 首页核心容器 (P00 首页)**
    *   **顶部导航**
        *   `Avatar` 头像 $\rightarrow$ **[P20 个人中心]**
    *   **店铺招牌**
        *   展示：商户 Logo、名称、Slogan、营业状态
    *   **卡片堆叠区**
        *   **[A] 碎银卡 (碎银)** (常驻显示：余额 & **今日步数**) $\xrightarrow{展开}$ **[P01 碎银卡]**
            *   $\rightarrow$ **[P10 碎银集市]** (点击“逛集市”)
            *   $\rightarrow$ **[P11 游戏中心]** (点击“玩游戏”)
        *   **[B] 储值卡 (储值)** $\xrightarrow{展开}$ **[P02 储值卡]**
            *   $\rightarrow$ **[P12 充值中心]** (点击 Banner)
            *   $\rightarrow$ **[P13 账单明细]** (点击“查看账单”)
        *   **[C] 入席令卡 (入席令)** (资产预览：Flow 堆叠) $\xrightarrow{展开}$ **[P03 入席令卡]**
            *   $\rightarrow$ **[P15 双模收银台 - 模式 B]** (卡片内点击具体票券亮码)
        *   **[D] 碎片卡 (碎片)** (资产预览：水平 Flow 堆叠) $\xrightarrow{展开}$ **[P04 碎片卡]**
            *   $\rightarrow$ **[P10 碎银集市]** (管理中心内点击去获取)
    *   **策略活动区**
        *   **竖向滑动列表**：展示由商家确认发布的营销活动与资产通知。
    *   **底部支付坞**
        *   **设计原则**：**水晶支付坞**。采用顶层悬浮设计。
        *   **视觉效果**：毛玻璃（玻璃态）质感容器，边缘带有微弱的品牌圆滑流光，弱化沉重感，强调通透感。
        *   `支付按钮` $\rightarrow$ **[P15 双模收银台]**

---

## 第二章：首页与核心容器 (P00 首页)

### 2.1 整体布局
首页是所有功能的容器，采用**固定顶底 + 中间滚动**的结构。

| 区域 | 元素 | 描述与交互 |
| :--- | :--- | :--- |
| **顶部固定区** | **顶部导航** | **左上头像**：显示用户圆形头像。点击 $\rightarrow$ **[P20 个人中心]**。<br>**右上胶囊**：模拟小程序胶囊按钮。 |
| | **店铺招牌** | **定位**：紧贴顶部导航下方，**固定不动**。<br>**内容**：<br>1. 商户 Logo (圆形/方形)。<br>2. 商户名称 (大号加粗)。<br>3. 品牌 Slogan。<br>4. 营业状态标签。<br>**交互**：作为页面的固定题头，不随列表滚动。 |
| **可滚动区域** | **卡片堆叠区** | **定位**：位于店铺招牌下方。<br>**初始状态**：**折叠态**。所有卡片垂直堆叠，仅露出顶部 **75px** 标题区（额头）。<br>**交互**：<br>1. **下滑 (Swipe Down)**：模拟物理钱包，将卡片向下错开 (Fan Out)，展示完整内容。<br>2. **上滑 (Swipe Up)**：将错开的卡片重新折叠回初始状态。<br>3. **持续上滑**：当卡片折叠后，继续上滑将滚动整个页面，展示下方的策略活动区。 |
| | **策略活动区** | 位于卡片堆叠区下方。采用**竖向滑动列表**展示营销卡片与**任务进度引导**。 |
| **底部固定区** | **支付坞** | **水晶支付坞**：采用**毛玻璃质感**的悬浮条。始终位于全局最高层级 (Fixed Bottom)，遮盖滑动列表内容。 |

### 2.2 核心交互：多卡堆叠与单卡错开 (Multi-Stack & Single-Peek)

> **Z 轴语义**：卡片 index 越大，`z-index` 越高，越靠近屏幕（视觉上在最上层）。
> - Card 0 = 最底层（离屏幕最远）
> - Card 3 = 最顶层（离屏幕最近，覆盖其他所有卡）

*   **交互逻辑 V3 (Single Focus)**：
    1.  **堆叠态 (Default)**：所有卡片重叠，仅露出额头 (Header)。
    2.  **点击错开 (Tap to Focus)**：
        *   点击某张卡片 (Card N) 的额头。
        *   **Card N**：完整展露 (Fully Revealed)。
        *   **Card < N (下层卡，z 更低)**：向上收起/挤压。
        *   **Card > N (上层卡，z 更高)**：向下收起/挤压。
        *   **效果**：仅错开这一张卡片，其他卡片避让。
    3.  **拖拽预览 (Drag to Peek)**：
        *   按住某张卡片 (Card N) 的额头并上下拖动。
        *   **Card N 及所有 index > N 的卡（z 更高，覆盖在其上方的卡）**：跟随手指整体移动。
        *   **Card index < N 的卡（z 更低，在其下方的卡）**：轻微跟随（阻尼回响）。
        *   **松手后**：所有卡片弹簧复原至堆叠态。
    4.  **动画 (Animation)**：卡片移动需带有平滑的过渡动效；松手复原使用弹簧曲线 `cubic-bezier(0.32, 0.72, 0, 1)`。
    5.  **卡片比例 (Ratio)**：严格遵照真实银行卡比例 (85.60 : 53.98 ≈ 1.586)。

---



## 第三章：核心卡片 (Core Cards)

### P01. 碎银卡
*   **激活与显示**：首页点击标题区，该卡片完全展开占据主体视口，其余卡片根据相对位置执行自动**垂直避让**（上方上推，下方下推），且全程保持**恒定的 Z 轴顺序**（层级不交替）。
*   **功能**：展示通用货币状态，提供获取途径入口。
*   **卡片定义**：**生态活跃资产**。碎银是用户在游戏与健康生态中产出的核心货币，具有极高的获取频次和活跃属性，是连接游戏（P11）与集市（P10）的流动性桥梁。

#### 3.1 布局规范 (布局)
1.  **头部 (摘要区 / 折叠态可见)**:
    *   左侧：标签 `碎银`。
    *   **中间 (新增)**：**步数胶囊** (半透明背景 `bg-black/10`)，显示 `8,420` (实时同步)。
    *   右侧：数值 `12,850 两` (大号字体)。
2.  **功能网格 (功能入口)**:
    *   **[逛集市] 按钮**：
        *   文案：“采购/出售碎片”。
        *   交互：点击 $\rightarrow$ 跳转 **[P10 碎银集市]**。
    *   **玩游戏 按钮**：
        *   文案：“赢取积分 (今日剩余3次)”。
        *   交互：点击 $\rightarrow$ 跳转 **[P11 游戏中心]**。
3.  **步数兑换**:
    *   **视觉融入**：不再是独立组件，而是作为碎银的一级产出源。
    *   **交互设计**：
    *   **兑换按钮**：维持原逻辑，变为高亮的 **[收银]** 按钮时产出碎银。文案提示当前进度 (如 8420/10000)。
4.  **简要流水 (近期流水)**:
    *   列表展示最近 3 条碎银变动记录（仅摘要）。
5.  **零状态引导 (Zero State - Intuitive Guide)**:
    *   **场景**：当用户碎银余额为 0 且无流水时。
    *   **表现**：功能网格中的 **[玩游戏]** 按钮启动**呼吸高亮动画**，文案动态变更为 **“👉 点这里，赢取第一桶金”**。利用界面元素的自我强调来替代弹窗引导。

---

### P02. 储值卡
*   **激活与显示**：首页点击标题区，该卡片完全展开占据主体视口，其余卡片根据相对位置执行自动**垂直避让**（上方上推，下方下推），且全程保持**恒定的 Z 轴顺序**（层级不交替）。
*   **功能**：展示真金白银资产，提供充值入口。
*   **卡片定义**：**确定性信用资产**。储值卡代表用户对商家的现金预付，强调财务的安全透明与即时可用性，是顾客与商家之间最高层级的信用契约。

#### 3.2 布局规范 (布局)
1.  **头部 (摘要区)**:
    *   左侧标签 `储值`。
    *   右侧数值 `¥120.00`。
2.  **资产构成 (资金分布)**:
    *   **本金**：用户实付充值的金额，标注“可退款”。
    *   **赠送金**：商户营销注入金额，标注“活动金”。
    *   *注：直观展示资金构成，建立安全感。*
3.  **推广横幅 (充值入口)**:
    *   样式：横幅广告位，色彩鲜艳 (Pink/Rose)。
    *   **零状态引导**：若余额为 0，文案显示 **“首充好礼 | 充 ¥200 送 ¥20，立即开通 >”**。
    *   交互：点击 $\rightarrow$ 跳转 **[P12 充值中心]**。
4.  **底部操作**:
    *   全宽按钮 **[查看账单明细]**。
    *   交互：点击 $\rightarrow$ 跳转 **[P13 账单明细]**。

---

### P03. 入席令卡
*   **激活与显示**：首页点击标题区，该卡片完全展开占据主体视口，其余卡片根据相对位置执行自动**垂直避让**（上方上推，下方下推），且全程保持**恒定的 Z 轴顺序**（层级不交替）。
*   **功能**：快速预览、深度的资产管理、合成引导与社交互动。
*   **卡片定义**：**餐饮实物权证**。入席令是碎片合成的最终成果，属于“准实物资产”。设计上突出厚度感与拟物感，是用户在餐厅进行价值兑付的唯一物理凭证。

#### 3.3 布局规范 (布局)
1.  **资产预览区 (Flow 堆叠 - 展开态)**:
    *   **表现形式**：菜品图标采用 **Flow 流式堆叠**（Isometric 轴测视角）。
    *   **视觉深度**：图标沿 45 度轴线向斜后方延伸。
    *   **零状态引导 (Empty State)**：
        *   **场景**：用户未拥有任何入席令。
        *   **表现**：展示一个半透明的**虚线餐盘轮廓**，中心显示按钮 **[去合成第一道菜]**。
        *   **交互**：点击直接自动折叠本卡片，并展开 **[P04 碎片卡]**，形成无缝的任务流转。
2.  **全量管理模块**:
    *   **资产大厅**：平铺展示所有可用入席令详情（菜品名、有效期、稀有度）。点击具体票券 $\rightarrow$ 跳转 **[P15 双模收银台 - 模式 B]** 亮码核销。
    *   **合成工作台**：展示当前正在收集的菜品进度条（同步自 P04）。
    *   **社交礼品盒 [Phase 3 - V1 隐藏]**：管理“待领取的赠送”和“赠送记录”。
3.  **权益手册**:
    *   底部脚注入口。

---

### P04. 碎片卡
*   **激活与显示**：首页点击标题区，该卡片完全展开占据主体视口。其余卡片根据相对位置执行自动**垂直避让**（上方上推，下方下推），且全程保持**恒定的 Z 轴顺序**（层级不交替）。
*   **功能**：资产深度预览、食谱切换、食材合成。
*   **卡片定义**：**过程性养成资产**。碎片是合成入席令的中间原材料，通过养成式的收集（集市购买或步数转化）赋予用户游戏化的掌控感，是通往最终美食成果的必经之路。

#### 3.4 布局规范 (布局)
1.  **里程碑挑战 (产出源同步)**:
    *   **视觉表现**：在碎片卡内引入横向线性进度条，节点标注 `10,000` 与 `20,000` 步。
    *   **奖励掉落**：分别挂载 **[普通碎片]** (10k 📦) 与 **[稀有碎片]** (20k 💎)。
    *   **动态性说明**：奖励掉落受商户每日风控预算限制。若商户进入“经济模式”，奖励可能自动转换或门槛动态上浮。
    *   **交互反馈**：步数达标时节点高亮脉冲。点击已达标节点 $\rightarrow$ 触发碎片爆裂掉落动效，奖励存入资产预览区。
2.  **资产预览区 (水平 Flow 堆叠 - 展开态可见)**:
    *   **表现形式**：展示当前拥有的所有碎片图标，采用**水平 Flow 流式堆叠**。
    *   **详情标注**：每个食材图标右下角附带**数量标 (如 x2)**。
    *   **交互**：仅作为资产状态展示，点击唤起下方合成工作台。
    *   **零状态引导**：若无碎片，显示文案 **“空空如也？去 [集市] 逛逛或 [玩游戏] 赢取”**，点击关键词直接跳转对应页面。
3.  **合成工作台 (展开态核心功能区)**:
    *   **显示逻辑**：默认**仅平铺展示当前已有进度**（即至少拥有 1 个对应食材）的食谱项目。
        *   **新手冷启动**：若用户没有任何碎片（无法触发默认逻辑），则**强制展示**商户配置的“推荐入门菜品”（如 葱油拌面）的虚线合成槽，并高亮缺失的食材，引导用户去获取。
    *   **食谱选择轮**: 顶部横向滚动选择目标菜品 (类似实体刻度盘或滚动轮交互，无页签感)。
    *   **合成槽位 (水平布局优化)**: 
        *   由九宫格优化为**水平线性排列 (Scroll Row)** 或 **分层平铺**，适配单页纵向空间交互。
        *   展示所需食材的拥有情况（高亮/阴影）。
    *   **操作区**: **[立即合成]** 按钮。
        *   **库存校验 (Inventory Check)**: 实时检查服务端库存。
        *   **状态 A (正常)**: 亮起，点击触发合成光效。
        *   **状态 B (缺货)**: 按钮置灰，文案变更为 **"今日已售罄"**，且无法点击。
        *   **状态 C (碎片不足)**: 按钮显示为 **"去集市找找"**，点击跳转 P10。
4.  **跳转引导**: 点击缺失食材提示跳转 **[P10 碎银集市]**。

---

## 第四章：专项功能界面 (Specialized Functional Interaces)

### P10. 碎银集市 (集市)
*   **入口**：P01 碎银卡内点击 [逛集市]；P04 碎片卡内点击 [缺失食材]。
*   **设计原则**：**流动式纵向集市**。取消页签切换，采用单一滑屏容器，通过纵向滑动切换功能区。
*   **布局规范**：
    1.  **顶部：每日货架 (采购摊位)**:
        *   **每日特惠**：横向滚动展示 3 个随机普通碎片 (碎银计价)。
        *   **稀有黑市**：展示 1 个高亮稀有碎片 (高价/限量)。
    2.  **底部：我的背囊 (回购摊位)**:
        *   **表现形式**：位于采购区下方，下滑即可进入。
        *   **交互逻辑**：网格展示个人碎片库存。点击碎片弹出底部操作条，实时显示商行回收价，点击 **[出售]** 换取碎银。

### P11. 游戏中心 (游戏中心)
*   **设计原则**：**神秘街机厅 (Arcade Discovery)**。游戏不设预告，通过“盲盒”机制激发探索欲。
*   **入口**：P01 碎银卡内点击 [玩游戏]。
*   **交互规范**：
    1.  **探索发现 (盲盒态)**:
        *   界面展示一系列排列整齐的**虚拟盲盒**或**待机态街机位**。
        *   卡片呈现深色剪影，仅显示“？”或微弱的动效光环。
    2.  **解锁激活 (开盒感)**:
        *   **激活条件**：消耗碎银、达成特定食谱（入席令）、或随机触发掉落。
        *   **动效**：点击“开盒” $\rightarrow$ 播放拟真的“撕开包膜”或“屏幕亮起/系统初始化”动效，瞬间 Reveal 游戏封面与玩法快照。
    3.  **资产收藏**:
        *   已揭晓的游戏将色彩归位，正式作为“游乐资产”入驻。用户可通过**水平卡片滚动 (Horizontal Flow)** 快速启动。
    4.  **激励奖励与结算**:
        *   **基础奖励**：游戏分数按比例产出 `碎银` (如 1:100)。
        *   **卓越奖励 (高分掉落)**：随机掉落 **[食材碎片]**。掉落概率与门槛由商户侧风控 AI 根据实时预算动态动态微调。
        *   **产出闭环**：获得的碎片实时同步至 [P04 碎片卡]合成槽位中。

### P12. 充值中心 (充值中心)
*   **入口**：P02 点击 Banner。
*   **布局**：
    *   **充值档位网格**：如 `¥50`, `¥100`, `¥200 (热销)`。
        *   每个卡片明确标注：实付 ¥200，到账 ¥220 (含 ¥20 赠送)。
    *   **协议区**：底部固定。必须勾选 *“我已知晓退款时将扣除已消费的赠送金权益”*。
    *   **支付按钮**：微信/支付宝唤起。

### P13. 账单明细 (账单明细)
*   **入口**：P02 点击 [查看账单]。
*   **布局**：
    *   无限滚动列表。
    *   每行：左侧 (类型与时间)，右侧 (变动金额，绿进黑出)。
    *   类型涵盖：充值、消费、退款、游戏奖励、集市交易。
    *   **补开发票 (Invoice Request)**：
        *   针对“消费/充值”类条目，点击详情可看到 **[申请开票]** 按钮。
        *   **交互流程**：
            1.  填写/选择发票抬头 (支持从微信发票助手导入)。
            2.  提交申请 $\rightarrow$ 状态变更为 `Pending`。
            3.  **状态反馈**：
                *   若商户上传了 PDF，点击 **[查看发票]** 直接在小程序内打开 PDF 预览，支持保存/打印。
                *   若商户仅标记“已发邮件”，则提示“发票已发送至您的邮箱”。
    *   **申请退款 (Refund Request)**：
        *   针对“储值”或“未使用入席令”，点击详情可看到 **[申请退款]** 按钮。
        *   系统根据 [Clawback 回溯算法] 自动计算可退金额（扣除已消费的赠送权益）。
        *   用户确认金额后提交，等待商户审核。

---

### P15. 双模收银台 (收银台)
*   **设计原则**：**拟物收银夹**。采用单页容器实现扫码与凭证的无缝切换，消除“切页感”。
*   **入口**：首页底部支付坞或外部商家码。
*   **核心交互**：
    *   **模式滑块 (Toggle)**：顶部或底部中心设置 **[扫码付款 | 会员凭证]** 轻量化胶囊滑块，点击或滑动进行原位状态切换。
    *   **模式 A (扫码付款 - 主动态)**：
        *   **交互逻辑**：
            1.  **输入总额**：用户输入消费总金额（如 ¥35.00）。
            2.  **智能抵扣 (Auto-Compute)**：
                *   系统瞬间计算**最优组合**：自动勾选 1 张 [招牌面入席令] (抵 ¥30) + 自动使用 [余额] (抵 ¥5)。
                *   UI 清晰展示：`总额 ¥35 - 券抵 ¥30 - 余额 ¥5 = 实付 ¥0`。
            3.  **确认支付**：一键完成核销与扣款。
    *   **模式 B (会员凭证 - 被动态)**：
        *   高亮展示二维码/条形码。
        *   **被扫逻辑**：商户扫码后，系统同样执行上述“智能抵扣”逻辑，直接在商户端完成扣款，用户端收到扣款通知。

### P20. 个人中心 (个人中心)
*   **入口**：首页左上角头像。
*   **布局**：
    *   **用户信息**：头像、昵称、UID。
    *   **数据概览**：累计消费、加入天数。
    *   **荣誉墙**：展示获得的勋章 (荣誉勋章)。
    *   **资产存档**：
        *   **[入席令历史]** 入口：点击查看所有已核销的入席令存根。
    *   **设置列表**：

---

## 第五章：全局组件 (Global Components)

### 5.1 Toast 与 弹窗
*   **获得资产**：使用全屏覆盖层 (动效覆盖层)，播放粒子特效，展示获得的物品与光效。
*   **错误提示**：顶部下拉提示 (如“余额不足”)。

### 5.2 状态同步
*   **实时同步 (WebSocket)**：所有页面需监听资产变动消息。
    *   例：在 [P10 碎银集市] 购买碎片后，返回 [P04 碎片卡]，碎银数值与碎片数量应当即刷新，无延迟。
