# 餐餐有戏 顾客端产品全景需求文档 (Master Customer Spec V1.1)

> **项目名称**：餐餐有戏 (MealQuest)
> **核心定义**：基于“资产包”逻辑的单页式餐饮应用。
> **文档目标**：本文档描述了产品的**页面层级结构 (Page Hierarchy)** 及**页面详细布局 (Page Layouts)**，明确所有功能的入口路径。

## 第一章：页面层级结构 (Page Hierarchy)

本系统采用“单页应用 (SPA)” 架构，无传统 TabBar。所有核心入口折叠于首页。

*   **L0. 启动层 (静默准入)**
    *   **微信静默登录**：应用启动即执行 `wx.login`，无感完成身份绑定，直接渲染首页。不再设立显式的登录引导页。
    *   **[外部扫码]** (仅限微信/App内扫一扫，**不支持系统相机**) $\rightarrow$ 直达 **[P15 双模收银台]** (带入商家信息)
*   **L1. 首页核心容器 (P00 首页)**
    *   **顶部导航 (顶部导航)**
        *   `Avatar` 头像 $\rightarrow$ **[P20 个人中心]**
    *   **店铺招牌 (店铺招牌)**
        *   展示：商户 Logo、名称、Slogan、营业状态
    *   **卡片堆叠区 (卡片堆叠区)**
        *   **[A] 碎银卡 (碎银)** (常驻显示：余额 & **今日步数**) $\xrightarrow{展开}$ **[P01 碎银卡]**
            *   $\rightarrow$ **[P10 碎银集市]** (点击“逛集市”)
            *   $\rightarrow$ **[P11 游戏中心]** (点击“玩游戏”)
        *   **[B] 储值卡 (储值)** $\xrightarrow{展开}$ **[P02 储值卡]**
            *   $\rightarrow$ **[P12 充值中心]** (点击 Banner)
            *   $\rightarrow$ **[P13 账单明细]** (点击“查看账单”)
        *   **[C] 入席令卡 (入席令)** (资产预览：Flow 堆叠) $\xrightarrow{展开}$ **[P03 入席令卡]**
            *   $\rightarrow$ **[P15 双模收银台 - 模式 B]** (卡片内点击具体票券亮码)
        *   **[D] 碎片卡 (碎片)** (资产预览：水平 Flow 堆叠) $\xrightarrow{展开}$ **[P04 碎片卡]**
            *   $\rightarrow$ **[P10 碎银集市]** (管理中心内点击去获取)
    *   **策略活动区 (策略活动区)**
        *   **竖向滑动列表**：展示由商家确认发布的营销活动与资产通知。
    *   **底部支付坞 (支付坞)**
        *   **设计原则**：**水晶支付坞 (水晶支付坞)**。采用顶层悬浮设计。
        *   **视觉效果**：毛玻璃（玻璃态）质感容器，边缘带有微弱的品牌圆滑流光，弱化沉重感，强调通透感。
        *   `支付按钮` $\rightarrow$ **[P15 双模收银台]**

---

## 第二章：首页与核心容器 (P00 首页)

### 2.1 整体布局
首页是所有功能的容器，由背景、顶部导航、中部卡片堆叠区、底部支付坞组成。

| 区域 | 元素 | 描述与交互 |
| :--- | :--- | :--- |
| **顶部导航** | **左上头像** | 显示用户圆形头像。点击 $\rightarrow$ **[P20 个人中心]**。 |
| **头部/摘要区** | **店铺招牌** | **定位**：顶部导航下方，卡片上方。<br>**内容**：<br>1. 商户 Logo (圆形/方形)。<br>2. 商户名称 (大号加粗，如“有戏小馆”)。<br>3. 品牌 Slogan (如“好戏在后头”)。<br>4. 营业状态标签 (营业中/休息中)。 |
| **主体区** | **卡片堆叠组** | 包含 4 张卡片 (碎银, 储值, 入席令, 碎片)。<br>初始状态为**折叠态**，每张卡片露出顶部 **75px** 标题区。 |
| | **策略活动区** | 位于卡片堆叠组下方。采用**竖向滑动列表**展示营销卡片与**任务进度引导**。<br>**实时动态**：显示步数提示（如：去 **[P01]** 换钱，或去 **[P04]** 领里程碑碎片奖励）。 |
| **底部** | **支付坞** | **水晶支付坞**：采用**毛玻璃质感**的悬浮条。始终位于全局最高层级，遮盖滑动列表内容，通过品牌流光动效吸引注意力。点击 $\rightarrow$ **[P15 双模收银台]**。 |

### 2.2 核心交互：堆叠与展开
*   **展开逻辑**：点击任意折叠卡片的标题区 $\rightarrow$ 该卡片占据主体视口并完全展开。
    *   **避让逻辑**：位于激活卡片**上方**的卡片整体向上推移，位于其**下方**的卡片整体向下推移。
    *   **Z 轴恒定**：所有卡片的堆叠顺序（Z-index）始终保持不变，严禁层级交替或通过“下沉”产生遮挡。
*   **折叠逻辑**：在展开态下，点击卡片标题区或背景空白处 $\rightarrow$ 所有卡片通过垂直位移恢复至初始堆叠态。
*   **互斥性**：同一时间只能展开一张卡片。

---

## 第三章：核心卡片 (Core Cards)

### P01. 碎银卡
*   **激活与显示**：首页点击标题区，该卡片完全展开占据主体视口，其余卡片根据相对位置执行自动**垂直避让**（上方上推，下方下推），且全程保持**恒定的 Z 轴顺序**（层级不交替）。
*   **功能**：展示通用货币状态，提供获取途径入口。
*   **卡片定义**：**生态活跃资产**。碎银是用户在游戏与健康生态中产出的核心货币，具有极高的获取频次和活跃属性，是连接游戏（P11）与集市（P10）的流动性桥梁。

#### 3.1 布局规范 (布局)
1.  **头部 (摘要区 / 折叠态可见)**:
    *   左侧：标签 `碎银`。
    *   **中间 (新增)**：**步数胶囊** (半透明背景 `bg-black/10`)，显示 `8,420` (实时同步)。
    *   右侧：数值 `12,850 两` (大号字体)。
2.  **功能网格 (功能入口)**:
    *   **[逛集市] 按钮**：
        *   文案：“采购/出售碎片”。
        *   交互：点击 $\rightarrow$ 跳转 **[P10 碎银集市]**。
    *   **玩游戏 按钮**：
        *   文案：“赢取积分 (今日剩余3次)”。
        *   交互：点击 $\rightarrow$ 跳转 **[P11 游戏中心]**。
3.  **步数兑换**:
    *   **视觉融入**：不再是独立组件，而是作为碎银的一级产出源。
    *   **交互设计**：
    *   **兑换按钮**：维持原逻辑，变为高亮的 **[收银]** 按钮时产出碎银。文案提示当前进度 (如 8420/10000)。
4.  **简要流水 (近期流水)**:
    *   列表展示最近 3 条碎银变动记录（仅摘要）。

---

### P02. 储值卡
*   **激活与显示**：首页点击标题区，该卡片完全展开占据主体视口，其余卡片根据相对位置执行自动**垂直避让**（上方上推，下方下推），且全程保持**恒定的 Z 轴顺序**（层级不交替）。
*   **功能**：展示真金白银资产，提供充值入口。
*   **卡片定义**：**确定性信用资产**。储值卡代表用户对商家的现金预付，强调财务的安全透明与即时可用性，是顾客与商家之间最高层级的信用契约。

#### 3.2 布局规范 (布局)
1.  **头部 (摘要区)**:
    *   左侧标签 `储值`。
    *   右侧数值 `¥120.00`。
2.  **资产构成 (资金分布)**:
    *   **本金**：用户实付充值的金额，标注“可退款”。
    *   **赠送金**：商户营销注入金额，标注“活动金”。
    *   *注：直观展示资金构成，建立安全感。*
3.  **推广横幅 (充值入口)**:
    *   样式：横幅广告位，色彩鲜艳 (Pink/Rose)。
    *   内容：“首充大礼 | 充 ¥200 送 ¥20”。
    *   交互：点击 $\rightarrow$ 跳转 **[P12 充值中心]**。
4.  **底部操作**:
    *   全宽按钮 **[查看账单明细]**。
    *   交互：点击 $\rightarrow$ 跳转 **[P13 账单明细]**。

---

### P03. 入席令卡
*   **激活与显示**：首页点击标题区，该卡片完全展开占据主体视口，其余卡片根据相对位置执行自动**垂直避让**（上方上推，下方下推），且全程保持**恒定的 Z 轴顺序**（层级不交替）。
*   **功能**：快速预览、深度的资产管理、合成引导与社交互动。
*   **卡片定义**：**餐饮实物权证**。入席令是碎片合成的最终成果，属于“准实物资产”。设计上突出厚度感与拟物感，是用户在餐厅进行价值兑付的唯一物理凭证。

#### 3.3 布局规范 (布局)
1.  **资产预览区 (Flow 堆叠 - 展开态)**:
    *   **表现形式**：菜品图标采用 **Flow 流式堆叠**（Isometric 轴测视角）。
    *   **视觉深度**：图标沿 45 度轴线向斜后方延伸。
    *   **交互**：点击卡片内任意位置 $\rightarrow$ 激活下方全量管理模块。
2.  **全量管理模块**:
    *   **资产大厅**：平铺展示所有可用入席令详情（菜品名、有效期、稀有度）。点击具体票券 $\rightarrow$ 跳转 **[P15 双模收银台 - 模式 B]** 亮码核销。
    *   **合成工作台**：展示当前正在收集的菜品进度条（同步自 P04）。
    *   **社交礼品盒**：管理“待领取的赠送”和“赠送记录”。
3.  **权益手册**:
    *   底部脚注入口。

---

### P04. 碎片卡
*   **激活与显示**：首页点击标题区，该卡片完全展开占据主体视口。其余卡片根据相对位置执行自动**垂直避让**（上方上推，下方下推），且全程保持**恒定的 Z 轴顺序**（层级不交替）。
*   **功能**：资产深度预览、食谱切换、食材合成。
*   **卡片定义**：**过程性养成资产**。碎片是合成入席令的中间原材料，通过养成式的收集（集市购买或步数转化）赋予用户游戏化的掌控感，是通往最终美食成果的必经之路。

#### 3.4 布局规范 (布局)
    *   **里程碑挑战 (产出源同步)**:
        *   **视觉表现**：在碎片卡内引入横向线性进度条，节点标注 `10,000` 与 `20,000` 步。
        *   **奖励掉落**：分别挂载 **[普通碎片]** (10k 📦) 与 **[稀有碎片]** (20k 💎)。
        *   **动态性说明**：奖励掉落受商户每日风控预算限制。若商户进入“经济模式”，奖励可能自动转换或门槛动态上浮。
        *   **交互反馈**：步数达标时节点高亮脉冲。点击已达标节点 $\rightarrow$ 触发碎片爆裂掉落动效，奖励存入资产预览区。
2.  **资产预览区 (水平 Flow 堆叠 - 展开态可见)**:
    *   **表现形式**：展示当前拥有的所有碎片图标，采用**水平 Flow 流式堆叠**。
    *   **详情标注**：每个食材图标右下角附带**数量标 (如 x2)**。
    *   **交互**：仅作为资产状态展示，点击唤起下方合成工作台。
2.  **合成工作台 (展开态核心功能区)**:
    *   **显示逻辑**：默认**仅平铺展示当前已有进度**（即至少拥有 1 个对应食材）的食谱项目。
    *   **食谱选择轮**: 顶部横向滚动选择目标菜品 (类似实体刻度盘或滚动轮交互，无页签感)。
    *   **合成槽位 (水平布局优化)**: 
        *   由九宫格优化为**水平线性排列 (Scroll Row)** 或 **分层平铺**，适配单页纵向空间交互。
        *   展示所需食材的拥有情况（高亮/阴影）。
    *   **操作区**: **[立即合成]** 按钮。
3.  **跳转引导**: 点击缺失食材提示跳转 **[P10 碎银集市]**。

---

## 第四章：专项功能界面 (Specialized Functional Interaces)

### P10. 碎银集市 (集市)
*   **入口**：P01 碎银卡内点击 [逛集市]；P04 碎片卡内点击 [缺失食材]。
*   **设计原则**：**流动式纵向集市**。取消页签切换，采用单一滑屏容器，通过纵向滑动切换功能区。
*   **布局规范**：
    1.  **顶部：每日货架 (采购摊位)**:
        *   **每日特惠**：横向滚动展示 3 个随机普通碎片 (碎银计价)。
        *   **稀有黑市**：展示 1 个高亮稀有碎片 (高价/限量)。
    2.  **底部：我的背囊 (回购摊位)**:
        *   **表现形式**：位于采购区下方，下滑即可进入。
        *   **交互逻辑**：网格展示个人碎片库存。点击碎片弹出底部操作条，实时显示商行回收价，点击 **[出售]** 换取碎银。

### P11. 游戏中心 (游戏中心)
*   **设计原则**：**神秘街机厅 (Arcade Discovery)**。游戏不设预告，通过“盲盒”机制激发探索欲。
*   **入口**：P01 碎银卡内点击 [玩游戏]。
*   **交互规范**：
    1.  **探索发现 (盲盒态)**:
        *   界面展示一系列排列整齐的**虚拟盲盒**或**待机态街机位**。
        *   卡片呈现深色剪影，仅显示“？”或微弱的动效光环。
    2.  **解锁激活 (开盒感)**:
        *   **激活条件**：消耗碎银、达成特定食谱（入席令）、或随机触发掉落。
        *   **动效**：点击“开盒” $\rightarrow$ 播放拟真的“撕开包膜”或“屏幕亮起/系统初始化”动效，瞬间 Reveal 游戏封面与玩法快照。
    3.  **资产收藏**:
        *   已揭晓的游戏将色彩归位，正式作为“游乐资产”入驻。用户可通过**水平卡片滚动 (Horizontal Flow)** 快速启动。
    4.  **激励奖励与结算**:
        *   **基础奖励**：游戏分数按比例产出 `碎银` (如 1:100)。
        *   **卓越奖励 (高分掉落)**：随机掉落 **[食材碎片]**。掉落概率与门槛由商户侧风控 AI 根据实时预算动态动态微调。
        *   **产出闭环**：获得的碎片实时同步至 [P04 碎片卡]合成槽位中。

### P12. 充值中心 (充值中心)
*   **入口**：P02 点击 Banner。
*   **布局**：
    *   **充值档位网格**：如 `¥50`, `¥100`, `¥200 (热销)`。
        *   每个卡片明确标注：实付 ¥200，到账 ¥220 (含 ¥20 赠送)。
    *   **协议区**：底部固定。必须勾选 *“我已知晓退款时将扣除已消费的赠送金权益”*。
    *   **支付按钮**：微信/支付宝唤起。

### P13. 账单明细 (账单明细)
*   **入口**：P02 点击 [查看账单]。
*   **布局**：
    *   无限滚动列表。
    *   每行：左侧 (类型与时间)，右侧 (变动金额，绿进黑出)。
    *   类型涵盖：充值、消费、退款、游戏奖励、集市交易。

---

### P15. 双模收银台 (收银台)
*   **设计原则**：**拟物收银夹**。采用单页容器实现扫码与凭证的无缝切换，消除“切页感”。
*   **入口**：首页底部支付坞或外部商家码。
*   **核心交互**：
    *   **模式滑块 (Toggle)**：顶部或底部中心设置 **[扫码付款 | 会员凭证]** 轻量化胶囊滑块，点击或滑动进行原位状态切换。
    *   **模式 A (扫码付款 - 主动态)**：
        *   金额输入键盘 + 动态计算折扣后的“实付金额”显示。
    *   **模式 B (会员凭证 - 被动态)**：
        *   高亮展示二维码/条形码。
        *   **定向焦点逻辑**：若由特定 [入席令] 唤起，下方列表首项将**高亮置顶**显示该入席令摘要，辅助商户肉眼确认核销项目。
        *   底部微距平铺：可用余额、待核销入席令列表（支持纵向滑动查看其它）。

### P20. 个人中心 (个人中心)
*   **入口**：首页左上角头像。
*   **布局**：
    *   **用户信息**：头像、昵称、UID。
    *   **数据概览**：累计消费、加入天数。
    *   **荣誉墙**：展示获得的勋章 (荣誉勋章)。
    *   **资产存档**：
        *   **[入席令历史]** 入口：点击查看所有已核销的入席令存根。
    *   **设置列表**：

---

## 第五章：全局组件 (Global Components)

### 5.1 Toast 与 弹窗
*   **获得资产**：使用全屏覆盖层 (动效覆盖层)，播放粒子特效，展示获得的物品与光效。
*   **错误提示**：顶部下拉提示 (如“余额不足”)。

### 5.2 状态同步
*   **实时同步 (WebSocket)**：所有页面需监听资产变动消息。
    *   例：在 [P10 碎银集市] 购买碎片后，返回 [P04 碎片卡]，碎银数值与碎片数量应当即刷新，无延迟。
